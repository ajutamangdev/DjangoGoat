{% extends 'labs/xss/xss_lab_base.html' %}

{% block title %}Filter Bypass XSS - Django Goat{% endblock %}

{% block lab_content %}
<div class="bg-slate-800 rounded-xl p-6 border border-slate-700 mb-8">
    <h2 class="text-xl font-bold text-white mb-4">Filtered Comment System</h2>
    <form method="POST" action="" class="mb-6">
        {% csrf_token %}
        <div class="mb-4">
            <label for="comment" class="block text-slate-300 mb-2">Your Comment:</label>
            <textarea id="comment" name="comment" rows="4"
                class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2 text-white"
                placeholder="Enter your comment (XSS filters are active)"></textarea>
        </div>
        <button type="submit"
            class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors">
            Post Comment
        </button>
    </form>

    {% if request.method == 'POST' and request.POST.comment %}
    <div class="bg-slate-900 rounded-lg p-4 border border-slate-700 mb-4">
        <h3 class="text-lg font-semibold text-white mb-2">Filter Status</h3>
        <div class="space-y-2 text-sm">
            <p class="text-slate-300">Original input: <code
                    class="bg-slate-800 px-2 py-1 rounded">{{ request.POST.comment }}</code></p>
            <p class="text-slate-300">Filtered output: <code
                    class="bg-slate-800 px-2 py-1 rounded">{{ filtered_comment }}</code></p>
            {% if blocked_patterns %}
            <p class="text-red-400">Blocked patterns: {{ blocked_patterns|join:", " }}</p>
            {% endif %}
        </div>
    </div>

    <div class="bg-slate-900 rounded-lg p-4 border border-slate-700">
        <h3 class="text-lg font-semibold text-white mb-2">Your Comment</h3>
        <!-- Vulnerable: Displaying filtered but not properly escaped content -->
        <div class="text-slate-300">{{ filtered_comment|safe }}</div>
    </div>
    {% endif %}

    <div class="mt-6">
        <h3 class="text-lg font-semibold text-white mb-4">Active Filters</h3>
        <div class="bg-slate-900 rounded-lg p-4 border border-slate-700">
            <ul class="text-slate-300 space-y-1 text-sm">
                <li>• Blocks: &lt;script&gt;, &lt;/script&gt;</li>
                <li>• Blocks: javascript:, onclick, onload, onerror</li>
                <li>• Blocks: alert(), eval(), document.cookie</li>
                <li>• Case-sensitive filtering</li>
            </ul>
        </div>
    </div>
</div>
{% endblock %}
